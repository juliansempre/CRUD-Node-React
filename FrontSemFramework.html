
<!--
/////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////
///////// CRUD CONSUMINDO API SEM FRAMEWORK EM UM SIMPLES HTML //////////////////
/////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////// 
-->

<!--
    O atributo required no campo do formulário é usado para garantir que o conteúdo desse campo seja preenchido antes que o formulário possa ser submetido para a API.
-->

<!--
   O atributo name é usado para definir o nome do campo que será enviado junto com seus dados quando o formulário for submetido para o servidor. Quando você envia dados de formulário para um servidor, os dados são enviados como uma série de pares chave-valor, onde a chave é o nome do campo e o valor é o valor do campo.
-->

<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Usuários</title>
</head>
<body>
    <h1>Gerenciamento de Usuários</h1>
    <form id="user-form">
        <input type="hidden" id="user-id" />
        <label for="nome">Nome:</label>
        <input type="text" id="nome" required />
        <br>
        <label for="email">Email:</label>
        <input type="email" id="email" required />
        <br>
        <label for="fone">Fone:</label>
        <input type="text" id="fone" required />
        <br>
        <label for="data_nascimento">Data de Nascimento:</label>
        <input type="date" id="data_nascimento" required />
        <br>
        <button type="submit">Enviar</button>
    </form>
    <h2>Lista de Usuários</h2>
    <ul id="user-list"></ul>
    <script>
        //Insira a url da sua api
        const API_URL = 'http://localhost:8800/api/';

        const form = document.getElementById('user-form');
        const userIdInput = document.getElementById('user-id');
        const nomeInput = document.getElementById('nome');
        const emailInput = document.getElementById('email');
        const foneInput = document.getElementById('fone');
        const dataNascimentoInput = document.getElementById('data_nascimento');
        const userList = document.getElementById('user-list');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            const user = {
                nome: nomeInput.value,
                email: emailInput.value,
                fone: foneInput.value,
                data_nascimento: dataNascimentoInput.value
            };

            if (userIdInput.value) {
                // Atualizar usuário
                await fetch(`${API_URL}${userIdInput.value}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(user)
                });
                alert("Usuario atualizado");
            } else {
                // Enviar usuário
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(user)
                });
                alert("Usuario inserido com sucesso");
            }

            // Limpar o formulário
            form.reset();
            userIdInput.value = '';

            // Atualizar a lista de usuários
            await getUsers();
        });

// =====================
// retornar em tabela
// =====================

  async function getUsers() {
  const response = await fetch(API_URL);
  const users = await response.json();

  userList.innerHTML = '';

  const table = document.createElement('table');

  // Cabeçalho da tabela
  const tableHeader = document.createElement('tr');
  const headers = ['Nome', 'Email', 'Contato', ''];
  headers.forEach(headerText => {
    const th = document.createElement('th');
    th.textContent = headerText;
    tableHeader.appendChild(th);
  });
  table.appendChild(tableHeader);

  // Linhas da tabela
  users.forEach(user => {
    const row = document.createElement('tr');

    // Colunas da tabela
    const nomeCell = document.createElement('td');
    nomeCell.textContent = user.nome;
    row.appendChild(nomeCell);

    const emailCell = document.createElement('td');
    emailCell.textContent = user.email;
    row.appendChild(emailCell);

    const contatoCell = document.createElement('td');
    contatoCell.textContent = user.fone;
    row.appendChild(contatoCell);

    const actionsCell = document.createElement('td');

    const editButton = document.createElement('button');
    editButton.textContent = 'Editar';
    editButton.addEventListener('click', () => {
      userIdInput.value = user.id;
      nomeInput.value = user.nome;
      emailInput.value = user.email;
      foneInput.value = user.fone;
      dataNascimentoInput.value = user.data_nascimento;
    });
    actionsCell.appendChild(editButton);

    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'Deletar';
    deleteButton.addEventListener('click', async () => {
      await deleteUser(user.id);
      await getUsers();
    });
    actionsCell.appendChild(deleteButton);

    row.appendChild(actionsCell);

    table.appendChild(row);
  });

  userList.appendChild(table);
}
//----------------------------------------------------------------
// =====================
// retornar em lista
// =====================

//CODIGO COMENTADO!

        // async function getUsers() {
        //     const response = await fetch(API_URL);
        //     const users = await response.json();

        //     userList.innerHTML = '';

        //     users.forEach(user => {
        //         const li = document.createElement('li');
        //         li.textContent = `Nome: ${user.nome} Email: ${user.email} Contato: ${user.fone}`;

        //         const editButton = document.createElement('button');
        //         editButton.textContent = 'Editar';
        //         editButton.addEventListener('click', () => {
        //             userIdInput.value = user.id;
        //             nomeInput.value = user.nome;
        //             emailInput.value = user.email;
        //             foneInput.value = user.fone;
        //             dataNascimentoInput.value = user.data_nascimento;
        //         });

        //         const deleteButton = document.createElement('button');
        //         deleteButton.textContent = 'Deletar';
        //         deleteButton.addEventListener('click', async () => {
        //             await deleteUser(user.id);
        //             await getUsers();
        //         });

        //         li.appendChild(editButton);
        //         li.appendChild(deleteButton);
        //         userList.appendChild(li);
        //     });
        // }
//----------------------------------------------------------------
        async function deleteUser(userId) {
            await fetch(`${API_URL}${userId}`, {
                method: 'DELETE'
            });
            alert("Usuario deletado");
        }

        // Carregar a lista de usuários ao abrir a página
        getUsers();
    </script>
</body>
</html>
<!-- //////////////////// FIM //////////////////////////////// -->